
# ~~引入：下载速度高引起断连~~（此项为排障后期测的，非问题发生期）
先看情况
![Pasted-image-20231204180542.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204180542.png)
软路由内部的信息并没有断连，也没有很高的延迟。


# 引入：上传速度引起的断连
图片都丢失了，这真的很让人难受啊。上传视频失败，联机问题等等依赖上行的服务真的很叫人难受啊。
![Pasted-image-20231204193928.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204193928.png)
此时的软路由信息:Network unreachable
![Pasted-image-20231204224516.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204224516.png)
# 组网情况说明
（我的组网是1.宿舍网口→2.软路由→3.纯AP模式路由器）
![Pasted-image-20231204022001.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204022001.png)
图示错误信息，可以看到e1000e一直在重置正在一直ping来查检查网络情况(X86软路由)，用核显接的显示器看到的，延迟已经达到了400多毫秒，有的时候甚至能到1000毫秒，体验感是非常非常难受的。
![xyblue2023_12_13_23_06_13.jpg](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/xyblue2023_12_13_23_06_13.jpg)
## 1.首先排除物理网线问题
更换网线后，依然存在此问题，说明网线质量没有问题。
![Pasted-image-20231203232728.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231203232728.png)

## 2.排除校园网的网络限制
测试完成:没有对上游网络进行限制，可以正常运行不掉线。
![Pasted-image-20231204022210.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204022210.png)

## 3.排除AP路由器故障(一)
将路由器由桥接模式改为默认模式以划分网段以防止可能的网络冲突，可以看到，依旧time out了。
![Pasted-image-20231204023221.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204023221.png)
![Pasted-image-20231204003211.png](%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4%E8%AE%B0%E5%BD%95/Pasted-image-20231204003211-202312115137879.png)

![Pasted-image-20231204003303.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204003303.png)

## 3.排除AP路由器故障(二)
虽然AP路由器是桥接模式，按道理来说不会经过AP的才对，这里把软路由移除掉，AP改为AC+AP模式，发现，没存在掉网的情况!上传也来到了572.42Mbps！也就是说故障应该出在了软路由上。
![Pasted-image-20231204022349.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204022349.png)
![Pasted-image-20231204003211.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204003211.png)

![Pasted-image-20231204003922.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204003922.png)
## 4.确认为软路由故障
基本判定软路由出问题的话，我们撤掉硬路由器，直接将本身路由器的wan口插入联网设备中并进行验证
![Pasted-image-20231204022935.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204022935.png)
可以看到依旧不可以，延迟也已经到了1000ms了，但此时我们离真相又近了一步。
![Pasted-image-20231203234153.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231203234153.png)
## 4.排除软路由故障（一）
可能是我们的软路由固件出现了问题？
从iStoreos换到了Esir的，并改了网络配置，依旧是这样的情况
![Pasted-image-20231204014743.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204014743.png)
## 排除软路由故障（二）
内网测速(下游网络下载上传给软路由)，没有问题，不会导致断开连接。
![Pasted-image-20231204221737.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204221737.png)
二次检测，我们使用SCP上传文件至软路由，成功，从软路由下载文件，成功。所以我们的下游设备上传下载从软路由上是没有问题的。
![Pasted-image-20231204185342.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204185342.png)
![Pasted-image-20231204190311.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204190311.png)
也就说，通过排错出现问题的点在这里:
![Pasted-image-20231204222000.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204222000.png)

## 验证软路由故障（一）
我的软路由分区情况如下:
![Pasted-image-20231204185107.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204185107.png)
可以看到我的X86软路由跟上级路由连接是用的主板网卡接口，下级是用的PCIE扩充网口，现在我把这两根线交换看一看。
![Pasted-image-20231204024944.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204024944.png)
![Pasted-image-20231204222611.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204222611.png)
![Pasted-image-20231204024419.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204024419.png)

并进入
```
vim /etc/config/network
```
重新配置新的网络
![Pasted-image-20231204024548.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204024548.png)
配置网络完成后，进行测速，有了奇怪的发现，这次上行不掉了，下行掉。确实有了新的发现。
![[需要放入网站的笔记/✓软路由故障排除记录/images/QQ视频20231204024632.mp4]
然后我们验证下游联网设备与软路由的连接状况，可以看到上传是没有问题的，但是下载会出现断连的情况。
![Pasted-image-20231204183629.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204183629.png)
![Pasted-image-20231204183641.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204183641.png)
![Pasted-image-20231204183350.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204183350.png)
![Pasted-image-20231204183405.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204183405.png)


## 排除软路由故障（六）
# 补充信息(一)
这个是内部的pcie网卡，是没有问题的，有两个插槽，无论插哪一个依旧上行掉（在最开始排错的时候，但这一步其实可以不做，没有必要。）
![Pasted-image-20231204025244.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204025244.png)

# 补充信息(二)
其实还是应该多看日志，看到接口eth0出现问题第一时间应该对eth0所在的网口进行测试。
![Pasted-image-20231204035558.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204035558.png)
# 补充信息（三）
限速处理：可以看到限制上传速度不会导致掉线，负载过高导致的？不至于吧，虽然是老网口，但你也支持千兆的啊。
![Pasted-image-20231204041812.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204041812.png)
![Pasted-image-20231204042028.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204042028.png)
# 解决方案
这边也只能pdd买一张新的PCIE转网口暂时用了，eth0就不加入软路由的配置了，我也有了自己的eth2！悲。主板卖家也确实可能知道这板子有问题，还要卖给我，有的时候还真的得谨慎购买，要不是我上行高一点，正常用的话也不会出现问题，也不好纠错，除非用内网的，是吧，卖家，这个空子你钻的是真好啊！
![Pasted-image-20231204025455.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204025455.png)
![Pasted-image-20231204224117.png](00_sync/00软路由/软路由故障排除记录/软路由故障排除记录/Pasted-image-20231204224117.png)
# 总结:
在排查网络连接问题时，需要逐步排除各种可能的故障原因，并进行验证。注意关注日志和错误信息，以及不同设备之间的连接情况。解决方案可能涉及硬件更换或配置调整，需要根据具体情况进行决策。在购买设备时，要谨慎选择，避免购买存在问题的产品。

