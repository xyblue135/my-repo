### 5G核心网
**系统架构** 

在5GC中，每个节点称为网络功能（NF），下面简要介绍一下每个NF的名称及功能。

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352502.jpg)

- NSSF（网络切片选择功能）：管理网络切片相关信息，比如负责为终端选择网络切片
- AUSF（认证服务器功能）：完成用户接入的身份认证功能，对应4G MME中鉴权功能
- UDM（统一数据管理）：管理和存储签约数据、鉴权数据
- AMF（接入和移动性管理功能）：完成移动性管理、NAS MM信令处理、NAS SM信令路由、安全锚点和安全上下文管理等
- SMF（会话管理功能）：完成会话管理、UE IP地址分配和管理、UP选择和控制等
- PCF（策略控制功能）：支持统一策略框架，提供策略规则
- AF（应用程序功能）：外部应用程序服务器
- UPF（用户面功能）：负责用户面处理，比如在无线接入网和Internet之间转发流量、报告流量使用情况、QoS策略实施等，对应4G EPC中的S/PGW的用户面
- DN（数据网络）：5GC外部数据网络（Internet等）

再来与4G EPC架构对比一下：

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352496.jpg)

EPC架构

可以发现，5GC的变化似乎并不大，不过增加了一些新节点（比如NSSF），以及一些节点被重新命名（比如原来的PCRF重新命名为CF）。

但这只是你看到的表明！

事实上，两者在功能方面有很多变化。

下面就简单说说5GC的6大变化，也是6大关键能力......

**控制面与用户面分离** 

啥叫控制面？啥叫用户面？简单说，用户面负责数据包传输，控制面负责连接的建立与断开等。

控制面与用户面分离并不是新鲜事，早在4G时代R14标准就定义了CUPS（EPC节点的控制面与用户面分离），也就是将SGW和PGW的控制平面和用户平面分离。

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352500.jpg)

R14中的EPC控制面与用户面分离

但在5GC中，分离更明显，更彻底...

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352495.jpg)

如上图，用户面（UPF）仅负责传输数据包，控制面（比如SMF）仅负责处理会话连接的建立和断开......这种控制面与用户面分离的架构，允许分别增强控制面功能和用户面（UPF）功能，更重要的是，可以将用户面（UPF）下沉到离用户更近的地方，从而大幅降低网络时延。

**不依赖于接入网的统一架构** 

在4G时代，3GPP接入网（比如LTE、WCDMA）与非3GPP接入网（比如Wi-Fi）以不同的方式连接到EPC。

但5G时代，不管是“3GPP接入网”（比如5G NR、LTE），还是其他“非3GPP接入网”都使用相同的接口连接到5GC。

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352497.jpg)

为此，R15定义了如何基于此原理使用N3IWF将“Untrusted non-3GPP access”（比如公共Wi-Fi）连接到5G系统。R16还研究了将有线接入网纳入统一的接入，这就是真正的“固网和无线融合”了。

**基于服务的架构（SBA）**

前面我们讲过5GC的系统架构图，这是我们熟悉的以“参考点表示”的架构图，这让我们易于理解核心网的节点之间是如何连接。但事实上，5G标准还给出了另一个更“真实”的5GC系统架构图......

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352498.jpg)

5GC架构（基于服务的架构）

如上图所示，5GC控制面引入了基于服务的架构（SBA）。在SBA中，每个NF并非一对一（点对点）连接，而是所有NF共享一条通信通道，每个NF都可以与任何NF通信。

为啥要采用SBA？在过去的EPC中，每一个节点单独定义“参考点”，每个节点之间采用单独的协议进行通信，这显然太复杂，不灵活。5GC认为不能再这么干了，于是将每个NF定义为“服务”，任何一个NF都采用相同的协议（HTTP/2），这样一来NF之间的连接就更弹性了，也大大增强了灵活扩展性。

但问题来了，在这样的SBA架构下，一个NF如何知道另一个NF提供的是什么服务呢？都提供了哪些服务呢？

于是，NRF（网络存储库功能）被引入到5G核心网控制面，其提供“服务注册”，“服务授权”和“服务发现”功能，具体点讲，就是负责对网络功能服务注册登记、状态监测等，实现网络功能服务自动化管理、选择和可扩展，并允许每个网络功能发现其它网络功能提供的服务。

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352501.jpg)

另外，还引入了NEF（网络开放功能），其解决了诸如AF（应用功能）之类的外部节点与5G核心网控制面中的节点之间基于SBA架构通信，比如AF可以通过NEF要求PCF将流量卸载到本地服务器。

**NWDAF（网络数据分析功能）** 

不知你注意到没有，在上面的5GC SBA架构图中，还引入了一个新的功能——NWDAF（网络数据分析功能）。顾名思义，NWDAF就是提供网络分析的NF，引入它的目的是实现网络自动化。

NWDAF定义了收集什么样的数据，怎样将分析结果反馈到网络等内容。但是，如何具体分析收集的数据，这很难用标准化来规范。NWDAF从整网收集数据，并与AI结合，可在5G网络中实现从数据收集，到数据分析，再到结果反馈的闭环自动化流程。

**分布式UPF** 

如上所述，在4G EPC中，SGW和PGW被分离为用户面节点，但在5GC中，只有UPF负责用户面，这是为了减少用户面节点数量来进一步减少网络时延。

下面你就能理解仅有一个UPF作为用户面的简洁设计所带来的好处了...

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352494.jpg)

如上图，通常在面向行业专网的5G组网中会配置两个（或两个以上）的UPF，一个通过N6接口连接DN，一个部署于边缘节点并连接到本地服务器，负责将本地流量卸载到本地，保障数据不出园区和网络低时延。要是用户面有SGW和PGW两个网元功能，带来更多节点，岂不是太累赘？

**网络切片** 

网络切片是个老熟人了，不用做太多介绍。

![](https://prod-1251541497.cos.ap-guangzhou.myqcloud.com/zixun_pc/zixunimg/img12/352499.jpg)

这里要介绍的是，通过网络切片，一个终端可以使用多个切片，好像最多可以连接8个切片。在切片网络中，AMF负责终端级的处理，例如用户身份验证和终端位置管理，因此，无论终端连接多少个切片，都由相同的AMF来负责处理。不过，每个切片都有单独的SMF和UPF，并分别连接不同的DN，这样终端上运行的多个应用可以通过各自的切片来保障网络能力，并且互不影响。

# UE (用户终端)
UE设备（User Equipment）在不同上下文中可能指代两种含义：

1. **移动通信领域的用户设备**： 在移动通信系统，特别是如2G、3G、4G、5G等蜂窝网络技术中，UE设备是指用户手中的终端设备，也就是用户用于接入无线通信网络进行语音通话、数据传输、互联网访问等各种移动通信服务的硬件装置。这包括但不限于智能手机、平板电脑、物联网设备（IoT devices）、车载通信模块、智能穿戴设备、便携式热点设备等。UE设备具备无线通信能力，可以通过内置的无线电模块与基站（Base Station，BS）或演进型NodeB（eNodeB）等网络基础设施进行交互，实现与核心网络的连接。UE在移动通信网络中的主要功能包括：
    
    - **广播寻呼及RRC连接处理**：接收网络广播信息和寻呼消息，建立和维护无线资源控制（Radio Resource Control, RRC）连接。
    - **切换和功率控制**：参与并执行网络指示的小区切换操作，以及自我调整发射功率以优化信号质量和网络效率。
    - **无线资源管理**：与网络协商并管理分配给自己的无线资源，如频率、时隙、编码方式等。
    - **基带和射频处理**：对上层数据进行编码、加密、调制等基带处理，并通过射频单元发送和接收无线信号。
    
    UE设备还包含多个协议栈层，如L2层的媒体接入控制（MAC）、无线链路控制（RLC）、分组数据汇聚协议（PDCP）和广播/多播控制（BMC），这些协议层负责处理数据传输的各个细节。
    
2. **用户体验（User Experience）的缩写**： 在产品设计、人机交互、市场营销等领域，UE有时也被用作“User Experience”的缩写，表示用户在使用某个产品或服务过程中形成的主观感受，包括情感、认知印象、易用性、满意度等多个方面。UE设计关注如何通过优化界面布局、交互逻辑、视觉呈现、信息架构、反馈机制等因素，提升用户在与产品交互过程中的整体满意度和效率。
    

综上所述，当提到“UE设备”时，若处于移动通信或电信技术的语境下，通常指的是用户端的移动通信终端设备；而在讨论产品设计、用户研究或相关服务领域时，则可能是指用户体验。要确定其具体含义，需依据所处的具体行业背景或上下文来判断。
# R(AN)
您提到的“R(AN)”可能是想要指代“RAN”（Radio Access Network，无线接入网）。在移动通信领域，RAN是构成整个移动通信系统的重要组成部分，负责将用户设备（UE）连接到核心网络（Core Network），实现无线通信服务。

**Radio Access Network (RAN)**:

RAN是提供无线接口（即空中接口）的网络部分，它使UE能够接入到更广泛的电信网络中，进行语音通话、数据传输、互联网访问等服务。在典型的移动通信架构中，RAN主要包括以下几个关键组件：

1. **Base Station (BS) / eNodeB (eNB) / gNodeB (gNB)**:
    
    - 在不同的移动通信标准中，基站的名称会有所不同。在2G/3G网络中，通常称为Base Transceiver Station (BTS) 或 Base Station (BS)，而在4G LTE网络中，基站被称为Evolved Node B (eNodeB, eNB)，在最新的5G网络中则被称为gNodeB (gNB)。
    - 这些基站设备负责在特定覆盖区域内广播无线信号，与UE建立和维护无线连接，进行无线资源管理，并执行数据的收发。
2. **Radio Units (RU) / Remote Radio Heads (RRH)**:
    
    - 在某些部署架构中，尤其是分布式或云化RAN（Cloud RAN, C-RAN）中，基站功能可能被分解为集中处理单元（Centralized Unit, CU）和分布式的无线单元（RU）。RU或RRH安装在站点边缘，直接负责射频信号的收发。
3. **Backhaul / Fronthaul Links**:
    
    - RAN与核心网络之间的高带宽连接称为回传（Backhaul），而CU与RU/RRH之间的连接称为前传（Fronthaul）。这些链路负责在基站和核心网络之间传输用户数据和控制信息。
4. **Control Plane / User Plane Functions**:
    
    - 在现代RAN架构中，特别是在5G网络中，RAN功能可以进一步虚拟化和云化。控制平面功能（如RRC, PDCP等）与用户平面功能（如PHY, MAC等）可能分别运行在不同的实体上，支持灵活的网络切片和功能分离。

RAN的主要职责包括：

- **无线资源管理**：调度无线资源（如频率、时间、空间资源等）给UE，确保高效、公平的数据传输。
- **信道质量监测**：实时监测无线信道条件，进行信道估计和干扰管理，以适应快速变化的无线环境。
- **接入控制**：处理UE的接入请求，进行身份验证、授权和安全密钥协商。
- **移动性管理**：支持UE在不同小区间的无缝切换，确保连续的业务体验。
- **协议处理**：执行无线接口相关的各层协议，如物理层（PHY）、媒体接入控制层（MAC）、无线链路控制层（RLC）、分组数据汇聚协议层（PDCP）等。

总之，RAN作为移动通信网络的关键一环，扮演着连接UE与核心网络的角色，通过提供和管理无线接入服务，确保用户能够在无线环境中顺利地使用各种电信业务。
# UPF_N3接口
UPF（User Plane Function，用户面功能）是5G（第五代移动通信）核心网（5GC, 5th Generation Core Network）中的一个重要网元，负责处理和转发用户面数据。在5G网络架构中，UPF承担了以下核心职责：

1. **数据包转发**：作为数据包在5G网络中传输的必经之路，UPF负责将UE（User Equipment，用户设备）从无线接入网（RAN，Radio Access Network）发送来的数据包正确地转发到外部数据网络（如互联网、企业专网等）或另一个UPF，反之亦然。
    
2. **流量定向和本地分流**：根据网络策略和用户会话信息，UPF可以实现数据流量的定向，即决定数据包应通过哪个出口（如特定的互联网网关、MEC节点等）离开核心网。此外，UPF支持本地数据分流（Local Breakout），即在靠近用户的地方直接将流量引出核心网，减少传输时延，满足低时延应用需求。
    
3. **策略执行**：UPF根据来自PCF（Policy Control Function，策略控制功能）的策略规则，对用户面数据进行速率控制、计费、深度包检测（DPI）等操作。
    
4. **网络切片支持**：在5G网络切片环境下，UPF能够为不同的网络切片提供独立的用户面处理和资源隔离，确保不同业务场景的服务质量和安全性。
    

至于为什么RAN（无线接入网）与UPF之间的接口被命名为“N3”，这是3GPP（第三代合作伙伴计划）在定义5G网络架构和接口规范时做出的标准化命名。在5G系统中，各个网元之间通过标准化的接口进行交互，这些接口都有特定的编号和名称。接口“N3”特指RAN（具体为gNodeB，即5G基站）与UPF之间的用户面数据传输接口，用于承载UE与外部数据网络之间的数据流量。

N3接口的设计和定义旨在实现以下功能：

- **高效的数据传输**：N3接口支持高速、低时延的数据传输，以适应5G时代的大带宽、低时延应用需求。
- **协议适配**：N3接口上可能运行GTP-U（GPRS Tunneling Protocol User Plane）等协议，用于封装和解封装用户数据，以及进行隧道管理。
- **流量统计与报告**：UPF通过N3接口收集流量统计数据，提供给计费系统或网络运维系统，支持网络监控和计费。

综上所述，UPF作为5G核心网中的用户面处理实体，通过N3接口与RAN相连，实现了无线接入网与核心网之间用户面数据的高效、安全、策略可控的传输。接口N3的命名是3GPP标准化过程的一部分，旨在确保不同厂商的设备能够遵循统一的标准进行互联互通。
# DN (外部网络)_N6接口
DN（Data Network，数据网络）在5G（第五代移动通信）网络中通常指外部的数据网络，它可以是互联网、企业内部网络、云服务提供商网络等。DN包含了用户通过移动网络访问的各种服务和应用的最终目的地，如网站、视频流服务、物联网平台等。当UE（User Equipment，用户设备）通过5G RAN（无线接入网）和5GC（核心网）发送或接收数据时，DN是数据传输路径的终点或起点。

UPF（User Plane Function，用户面功能）作为5G核心网中的重要组件，负责用户面数据的处理与转发。UPF与DN之间的接口被命名为“N6”，这是因为3GPP在定义5G网络架构和接口时，对核心网内部以及核心网与其他网络实体之间的接口进行了标准化命名。接口“N6”特指UPF与外部DN之间的接口，用于将用户数据从移动网络传输到DN，或者从DN接收数据并转发回移动网络。

N6接口的主要作用包括：

1. **数据包转发**：N6接口承载了从UPF到DN或从DN到UPF的数据流量，即UE与外部服务或应用之间的实际数据交换。
    
2. **协议适配**：N6接口可能需要支持多种协议，如IP（Internet Protocol）、TCP（Transmission Control Protocol）、UDP（User Datagram Protocol）等，以适应DN侧不同的服务需求和网络环境。
    
3. **QoS（Quality of Service）保障**：UPF在N6接口上可以实施QoS策略，如DSCP（Differentiated Services Code Point）标记，确保数据包在DN中得到适当的优先级处理，满足服务等级协议（SLA）要求。
    
4. **安全与策略控制**：N6接口可能涉及防火墙规则、IP过滤、深度包检测（DPI）等安全措施，以及根据网络策略对数据流量进行控制。
    
5. **计费与审计**：UPF通过N6接口收集流向DN的数据流量信息，用于计费、审计以及网络运营分析。
    

总结来说，DN在5G网络中代表用户数据最终到达或来源的外部数据网络，而N6接口则是UPF与DN之间进行用户面数据交换的标准化接口。这个接口的设计旨在确保从移动网络到外部数据网络的数据传输高效、安全、策略可控，并能够适应各种服务需求和网络环境。通过定义明确的接口标准，不同厂商的UPF和DN设备能够遵循统一的规范进行对接，实现互联互通。

# 信令
当然可以。简单地说，信令（Signaling）是指在通信系统中，为了协调、控制和管理通信过程而交换的一种特殊类型的信息。这些信息不直接涉及用户数据（如语音通话的内容、互联网浏览的数据包等），而是专注于确保用户数据能够正确、有序、安全地传输。信令就像通信网络中的“幕后指挥”，默默地指引着通信双方如何建立连接、维持通信、调整参数以及结束通信等操作。

以下是一些关于信令的简单描述和示例：

1. **通信过程的协调者**：
   - 当您拨打一个电话时，您的手机（UE，User Equipment）需要向移动网络发送信令，告诉网络您想与某个号码建立通话连接。网络收到请求后，通过一系列信令交互找到对方手机，安排资源，然后建立起双方之间的通话通道。

2. **状态与事件的通知**：
   - 当您在移动中从一个基站（Base Station）区域进入另一个基站区域时，您的手机会通过信令向网络报告位置变化。网络根据这些信息，通过信令与相关基站协调，确保您的通话或数据连接能够平滑过渡到新的基站，避免通信中断。

3. **参数配置与调整**：
   - 在互联网通话（VoIP）中，双方设备可能需要通过信令交换音视频编解码参数、带宽需求等信息，以确保双方都能正确解码对方的音频和视频数据，提供高质量的通话体验。

4. **安全与认证**：
   - 当您连接到Wi-Fi网络时，您的设备与Wi-Fi路由器之间会通过信令交换安全信息，如密码验证、加密密钥协商等，以确保通信的保密性和完整性。

5. **网络管理与计费**：
   - 运营商网络通过信令跟踪用户的行为（如呼叫记录、数据用量），用于计费、网络资源管理、故障排查等目的。例如，您的手机定期向网络发送信令报告数据使用情况，网络据此计算您的账单。

信令通常采用特定的通信协议（如SS7、SIP、 diameter、HTTP/RESTful API等）进行传输，并遵循一定的标准和规程，确保不同厂家的设备和网络能够互相理解并正确处理这些控制信息。信令系统是通信网络不可或缺的一部分，它隐藏在用户数据传输的背后，默默地支撑着整个通信服务的正常运作。
# AMF
当您通过您的用户设备（UE，如手机、平板电脑等）访问百度（一个互联网服务）时，数据传输的确会经过您描述的路径：从UE到RAN（无线接入网），再到UPF（用户面功能），最后通过DN（数据网络，即互联网）到达百度的服务器。以下是详细的数据传输流程：

1. **UE（User Equipment）**:
    
    - 您在UE上打开浏览器，输入百度的网址或点击百度应用的链接，发起对百度服务的访问请求。
2. **RAN（Radio Access Network）**:
    
    - UE通过无线接口（如5G NR、LTE等）将请求发送到最近的基站（如gNodeB、eNodeB等），这是RAN的一部分。
    - 基站将无线信号转换为有线信号，并通过回传网络（如光纤、微波等）将数据包传输到核心网。
3. **UPF（User Plane Function）**:
    
    - 数据包到达5G核心网后，首先经过SMF（Session Management Function，会话管理功能）进行会话建立和路由决策。
    - SMF确定应将用户数据转发至哪个UPF，并通过N4接口指示UPF建立相应的数据隧道。
    - UPF接收到数据包后，根据会话信息和网络策略进行处理，如QoS标记、流量整形、计费等，并通过N6接口将数据包转发到DN（互联网）。
4. **DN（Data Network，互联网）**:
    
    - 数据包通过N6接口离开UPF后，进入互联网（DN），按照IP路由原则被转发至百度的服务器所在网络。
    - 在互联网中，数据包可能经过多个路由器、交换机和其他网络设备，最终到达百度的服务器。
5. **百度服务器**:
    
    - 百度服务器接收到请求后，处理请求（如查询网页、检索数据等），并生成响应数据。
6. **反向路径**:
    
    - 响应数据沿原路径返回：百度服务器->互联网（DN）->UPF（通过N6接口）->RAN（基站）->UE。
    - UE接收到响应数据后，浏览器渲染网页内容，您即可在设备上看到访问的结果。

因此，当您访问百度时，数据传输的确沿着UE→RAN→UPF→DN（互联网）的路径进行。这是一个简化版的描述，实际过程中还涉及DNS解析、安全加密（如TLS/SSL）、TCP连接管理等环节，但您提供的路径概括了主要的网络跃点和数据流动方向。


AMF（Access and Mobility Management Function）是5G核心网（5GC）的关键组成部分，负责接入控制、移动性管理和与UE（User Equipment，用户设备，如手机、物联网终端等）相关的各种控制面功能。具体来说，AMF的主要职责包括：

1. **接入控制**：
    
    - 处理UE的初始接入请求，如注册、认证、鉴权等。
    - 决定是否允许UE接入网络，并分配网络资源。
2. **移动性管理**：
    
    - 跟踪UE的位置信息，以便在UE移动时能够及时更新其服务小区（如gNodeB），实现无缝切换。
    - 管理UE的移动性上下文，包括切换、重选、寻呼等过程。
3. **会话管理协助**：
    
    - 协同SMF（Session Management Function）进行会话建立、修改和释放的控制面操作。
4. **安全功能**：
    
    - 与UE协商并管理网络的安全参数，如加密密钥、完整性保护算法等。
5. **网络策略执行**：
    
    - 实施网络运营商定义的策略，如接入限制、服务质量（QoS）控制等。
6. **与其他网络功能交互**：
    
    - 与UDM（Unified Data Management，统一数据管理功能）交互获取用户订阅信息和鉴权数据。
    - 与AUSF（Authentication Server Function，认证服务器功能）协作完成UE的认证过程。
    - 与其他网络功能如PCF（Policy Control Function，策略控制功能）、SMSF（SMS Function，短消息服务功能）等进行必要的交互。

**N1接口**是UE与AMF之间的逻辑接口，用于承载非接入层（Non-Access Stratum，NAS）信令。这些信令主要涉及UE与核心网在控制面上的交互，包括但不限于：

- **注册与注销**：UE开机、进入新区域或网络状态变化时，通过N1接口向AMF发起注册请求，以告知其存在并获取网络服务。注销时，UE通过N1接口通知AMF断开连接。
    
- **认证与鉴权**：UE在注册过程中通过N1接口与AMF进行交互，完成身份认证和网络接入权限的鉴权。
    
- **移动性管理信令**：当UE移动到新的服务小区或需要进行切换时，通过N1接口与AMF交换相关信令，如测量报告、切换请求与确认等。
    
- **会话管理信令**：虽然会话管理的主体在SMF，但涉及UE的部分控制面信令，如PDU会话建立、修改、释放请求，可能通过N1接口传递给AMF。
    
- **网络策略指令**：AMF通过N1接口向UE发送网络策略或配置更新，指导UE如何使用网络资源或调整其行为。
    
- **寻呼消息**：当网络需要与处于空闲态的UE通信（如接收来电、推送消息等）时，AMF通过N1接口发送寻呼请求，指示RAN（无线接入网）寻找并通知UE。
**N2接口的作用**： N2接口承载了gNB与AMF之间的非接入层（NAS，Non-Access Stratum）信令和RAN控制面信息交换，具体包括但不限于以下内容：

1. **UE接入与移动性管理**：
    
    - 当UE首次接入网络或发生移动（如切换到另一个gNB）时，gNB通过N2接口向AMF发送相关信息，AMF据此进行接入控制、位置更新、移动性上下文管理等操作。
2. **会话管理协助**：
    
    - 在建立、修改或释放PDU会话（Packet Data Unit Session，相当于4G中的EPS bearer）的过程中，gNB与AMF通过N2接口交换必要的控制信息，如会话创建请求、修改请求、释放请求等。
3. **网络资源管理**：
    
    - gNB通过N2接口向AMF报告无线资源使用情况、UE测量报告等信息，AMF据此进行网络资源分配、负载均衡等决策。
4. **故障报告与恢复**：
    
    - 当gNB或其服务的UE出现故障时，gNB通过N2接口向AMF上报故障信息，AMF可以据此采取相应措施，如重新分配资源、触发故障恢复流程等。
5. **安全功能**：
    
    - gNB与AMF通过N2接口协作进行安全上下文管理，如密钥协商、完整性保护算法协商等。

**N2接口的技术特性**：

- 通常基于IP网络进行传输，支持TCP或SCTP（Stream Control Transmission Protocol）作为传输层协议。
- 使用NGAP（Next Generation Application Protocol）作为应用层协议，定义了gNB与AMF之间信令消息的格式和交互流程。

总结来说，AMF作为5G核心网中的关键控制面功能实体，通过N1接口与UE进行交互，处理接入、移动性、安全、会话管理等方面的控制信令，确保UE能够安全、高效地接入和使用5G网络服务。N1接口的存在使得UE与AMF能够在控制层面进行必要的通信，协调UE与核心网的行为，实现网络的正常运行和管理。总结来说，N2接口是5G网络中连接RAN（gNodeB）与核心网（AMF）的关键控制面接口，它承载了UE接入、移动性管理、会话管理、网络资源管理等控制面信令交互，对于确保UE与5G网络的正常通信至关重要。

# SMF
SMF（Session Management Function）是5G（第五代移动通信）核心网（5GC）中的一个重要功能实体，负责管理用户设备（UE）与网络之间的会话（Session）相关事宜。具体来说，SMF的主要职责包括：

1. **会话建立与管理**：
   - 接收来自UE、AMF（Access and Mobility Management Function）或其他网络功能的会话建立请求，如PDU（Packet Data Unit）会话建立请求。
   - 选择合适的UPF（User Plane Function，用户面功能），并指示UPF为会话创建用户面隧道。
   - 与UE、AMF、PCF（Policy Control Function，策略控制功能）等交互，完成会话的建立过程，包括QoS（Quality of Service）参数协商、计费信息配置等。
   - 在会话生命周期内，根据需要修改会话属性（如QoS、路由等）或处理会话释放请求。

2. **用户面路径控制**：
   - 确定用户数据的传输路径，即选择和配置UPF，并通过N4接口向UPF下发隧道建立、修改和删除指令。
   - 管理用户面隧道的生命周期，包括隧道状态、隧道故障恢复等。

3. **IP地址分配与管理**：
   - 对UE分配或撤销IPv4/IPv6地址，可能包括动态分配（如通过DHCPv4/v6）或静态配置。
   - 维护UE的IP地址与会话关联关系。

4. **策略执行与计费**：
   - 与PCF交互获取会话相关的策略规则，并在用户面路径上实施这些规则，如流量整形、速率限制、计费标签插入等。
   - 收集会话相关的计费数据，如流量用量、会话时长等，并发送给计费系统。

5. **网络切片支持**：
   - 在网络切片环境中，SMF负责为UE在特定网络切片内建立会话，确保会话资源和处理遵循该切片的特定服务特性。

6. **与其他网络功能交互**：
   - 与AMF、AUSF（Authentication Server Function，认证服务器功能）、UDM（Unified Data Management，统一数据管理功能）等进行必要的交互，获取或验证用户身份、鉴权信息、签约数据等，以支持会话管理决策。

总之，SMF在5G网络中扮演着会话控制器的角色，负责协调、配置和维护UE与网络之间的数据传输路径（即会话），确保数据能够按照预定的服务质量、安全策略、计费规则等要求进行有效传输。SMF通过与其他网络功能（如AMF、UPF、PCF等）的紧密协作，为用户提供透明、可靠、可管理的通信服务。
# AF
AF（Application Function）在5G（第五代移动通信）网络架构中，通常是指与网络服务密切相关的应用层功能实体。AF可以是运营商内部的服务平台，如VoLTE（Voice over LTE）应用服务器、视频优化平台等，也可以是第三方提供的应用，如OTT（Over-the-Top）服务、企业级应用等。AF与PCF（Policy Control Function，策略控制功能）通过N5接口进行交互，实现网络策略与应用需求的联动。具体来说：

**AF的主要职责**：

- **应用需求表达**：
    
    - AF根据其提供的服务特性或用户需求，向网络（主要是PCF）提出特定的策略请求，如QoS需求、计费规则、安全策略等。
- **网络服务调用**：
    
    - AF可能需要调用网络提供的服务，如获取用户位置信息、查询网络状态、触发特定的网络操作等。这些请求通常通过N5接口发送给PCF，由PCF协调其他网络功能完成服务。
- **策略反馈与调整**：
    
    - AF根据应用的实际运行情况，可能需要向PCF反馈策略执行效果，如QoS指标、计费事件等。根据这些反馈，PCF可能需要调整策略以优化服务。

**N5接口**：

- **接口定义**：
    
    - N5接口是标准化的接口，定义了AF与PCF之间交互的消息格式、流程和协议。它允许AF以统一的方式与网络进行交互，而不必关心底层网络的具体实现。
- **消息类型**：
    
    - N5接口支持多种消息类型，如策略请求（Policy Request）、策略响应（Policy Response）、策略更新通知（Policy Update Notification）、事件报告（Event Report）等，涵盖了AF与PCF之间大部分的策略交互需求。
- **接口安全**：
    
    - N5接口通常需要实施严格的安全措施，如身份认证、消息加密、完整性保护等，以确保策略信息的安全传输和防止非法篡改。
- **服务发现与注册**：
    
    - 在某些情况下，AF可能需要通过N5接口向PCF注册其提供的服务，或者发现网络中可用的AF服务。这有助于构建灵活、动态的网络服务生态系统。

**N5接口的作用**： N5接口连接AF与PCF，使得AF能够根据应用需求向网络提出策略请求，获取网络服务，以及反馈策略执行效果。通过N5接口，AF与PCF之间能够进行策略信息的双向交互，实现网络策略与应用需求的紧密耦合，提高服务质量和用户体验。同时，N5接口的标准化设计促进了不同AF与PCF之间的互操作性，简化了网络服务的开发和部署。

# NSSF AUSF UDM
- NSSF（网络切片选择功能）：管理网络切片相关信息，比如负责为终端选择网络切片
- AUSF（认证服务器功能）：完成用户接入的身份认证功能，对应4G MME中鉴权功能
- UDM（统一数据管理）：管理和存储签约数据、鉴权数据
NSSF（Network Slice Selection Function）、AUSF（Authentication Server Function）和UDM（Unified Data Management）是5G（第五代移动通信）核心网（5GC）中负责特定功能的三个重要网络功能实体。以下是它们各自的职责和相互间的关系：

**NSSF (Network Slice Selection Function)**:

**网络切片选择**：
    
    - NSSF负责为UE（User Equipment，用户设备）选择最合适的网络切片实例，考虑因素包括UE的订阅信息、网络状况、服务需求等。
    - NSSF通过与AMF（Access and Mobility Management Function）、UDM等交互，获取UE和网络的相关信息，进行切片选择决策。
- **网络切片信息管理**：
    
    - NSSF维护网络中所有可用切片的信息，包括切片描述、可用性、容量、性能等，并通过Nnrf_NSSF接口向其他网络功能（如AMF、UDM、PCF等）提供切片查询服务。
- **网络切片策略协调**：
    
    - 在某些场景下，NSSF可能需要协调不同网络切片之间的资源共享、策略冲突等问题，确保网络切片的高效、稳定运行。

**AUSF (Authentication Server Function)**:

- **用户身份认证**：
    
    - AUSF负责处理UE的接入认证请求，包括EAP（Extensible Authentication Protocol）方法的执行、认证数据的验证等。
    - AUSF与UDM、SEAF（Subscription Identifier De-concealment Function，如果启用的话）等交互，获取必要的认证数据和用户签约信息。
- **安全密钥管理**：
    
    - AUSF参与生成、分发和更新UE与网络之间的安全密钥（如Kseaf、Kausf），为后续的通信提供安全保障。

**UDM (Unified Data Management)**:

- **用户数据管理**：
    
    - UDM是用户数据的集中存储库，管理UE的签约数据、认证数据、策略数据、订阅信息等。
    - UDM通过Nudm_*系列接口，为其他网络功能（如AMF、AUSF、PCF、NSSF等）提供用户数据查询、更新等服务。
- **用户身份验证支持**：
    
    - UDM为AUSF提供必要的认证数据，如SUPI（Subscription Permanent Identifier）、OP（Operator Public Key）等，支持UE的接入认证过程。
- **网络切片数据管理**：
    
    - UDM存储和管理与网络切片相关的用户数据，如UE对特定切片的订阅信息、权限等，支持NSSF的切片选择决策。

这三个网络功能实体虽然职责各异，但它们共同为5G网络提供核心的管理和服务支持。NSSF确保UE能够接入最适合其需求的网络切片；AUSF负责保护网络免受未授权接入的威胁，确保通信安全；UDM作为用户数据的中央仓库，为其他网络功能提供必要的数据支持。它们之间通过标准化接口进行交互，共同构建起灵活、可扩展、安全的5G核心网架构。
