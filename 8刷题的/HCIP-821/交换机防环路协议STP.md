

# 端口判断
![[8刷题的/HCIP-821/----/Pasted image 20240720031404.png]]# 知识：根端口失效，三个stp的过程
### STP（Spanning Tree Protocol）

在STP中，当根端口失效时，网络会经历一个较长的收敛过程。具体步骤如下：

1. **检测根端口失效**：
    
    - 交换机检测到根端口失效，停止接收和发送BPDU（Bridge Protocol Data Units）报文。
2. **重新计算生成树**：
    
    - 交换机通过发送配置BPDU（Configuration BPDU）来通知网络中其他交换机，重新计算生成树。
3. **端口状态转换**：
    
    - 替代端口（Alternate Port）会首先进入侦听（Listening）状态，等待时间等于转发延迟时间（默认15秒）。
    - 进入学习（Learning）状态，等待时间等于转发延迟时间（默认15秒）。
    - 最后进入转发（Forwarding）状态。

由于每个状态的等待时间为15秒，总收敛时间可以长达30到50秒。

### RSTP（Rapid Spanning Tree Protocol）

在RSTP中，根端口失效后的收敛过程要比STP快得多。具体步骤如下：

1. **检测根端口失效**：
    
    - 交换机检测到根端口失效，立即停止接收和发送BPDU报文。
2. **快速收敛**：
    
    - RSTP使用同步和握手机制，可以快速将备用端口（Alternate Port）或备份端口（Backup Port）转换为新的根端口。
3. **端口状态转换**：
    
    - 替代端口或备份端口会立即转换为转发状态，而不会经历侦听和学习状态的延迟。

### MSTP（Multiple Spanning Tree Protocol）

MSTP结合了RSTP的快速收敛特性和多实例生成树的优点。具体步骤如下：

1. **检测根端口失效**：
    
    - 交换机检测到根端口失效，立即停止接收和发送BPDU报文。
2. **快速收敛**：
    
    - MSTP在每个MST实例（MST Instance，MSTI）中独立运行RSTP的快速收敛机制。
    - 使用同步和握手机制，可以快速将备用端口或备份端口转换为新的根端口。
3. **端口状态转换**：
    
    - 替代端口或备份端口会立即转换为转发状态，而不会经历侦听和学习状态的延迟。

### 总结

- **STP**：根端口失效时，替代端口需要经历侦听（15秒）和学习（15秒）状态，总收敛时间可达30到50秒。
- **RSTP**：根端口失效时，替代端口可以立即转换为转发状态，收敛时间显著缩短。


# 关于选举
根桥的交换机选举看CISTBridge小的那个 
然后选好根交换机之后，也要给自己一些指定端口处于forwarding状态。

非根桥的交换机哪个是root根端口，看端口顺序，**小的端口更容易被选举**，如23比24端口小。另外一个就作为其余端口了（alter bakup）
# 选举根桥
![image-20247192335104.png|400](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/STP/image-20247192335104.png)
正确的是哪一项？
**根桥是SWA**
根桥无法确定
根桥是SWB
根桥是SWC
<u>桥优先级默认为32768，越小越优先，因此SWA为4096是最小的，成为根桥</u>
# 例题 根端口失效1
发生故障，会有什么
![image-20247143221876.png|500](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/STP/image-20247143221876.png)
SWC上的预备端口成为新的根端口，并经过Learning状态后进入Forwarding状态
SWC重新选举根端口，并直接进入Forwarding状态
**SWC上的预备端口成为新的根端口，并直接进入Forwarding状态     （现在脑子清晰能转弯，不知道以后，alternative端口已经蠢蠢欲动了只能说）**
SWC重新选举根端口，并经过Learning后进入Forwarding状态
<u>根端口（Root Port）并不一定直接连接到根交换机（Root Bridge），而是指一个交换机上通向根交换机路径最短的端口。它是通往根交换机的最优路径上的端口，无论这条路径是直接连接还是通过其他交换机间接连接。以下是详细的解释：
</u>
# 例题 rstp 根端口失效2
RSTP协议中，当根端口失效的情况下，哪个的端口会快速转换为新的根端口并立即进入转发状态？
Forwarding 端口
Backup端口
Edge端口
**Alternated 端口**
<u>解析：RSTP中，AP是RP的备份，可以进行快速切换。</u>
# 例题 tc-protect
描述错误的是`[SWB]stp tc-protection?` `Disable TC protection function disable` `Enable TC protection function enable
启用TC保护功能后，在单位时间内， MSTP进程处理类型BPDU报文的次数可配置
启用TC保护功能，可避免攻击者伪造拓扑变化BPDU报文来恶意攻击交换设备，并造成其频繁的删除MAC地址表项和
ARP表项，从而达到保护交换设备的目的
**执行命令stp tc-protection enable使能MSTP进程TC类型BPDU报文的保护功能。**
缺省情况下交换设备的TC保护功能处于未使能状态
<u>**stp tc-protection**命令用来使能设备对TC类型BPDU报文的保护功能。 |真服了华子这边是没有enable的，enable哪个是h3c
**undo stp tc-protection**命令用来去使能设备对TC类型BPDU报文的保护功能。</u>
<u>在生成树协议（STP，Spanning Tree Protocol）中，"TC Protect"（Topology Change Protection）是一个功能，用于保护网络免受频繁的拓扑变化（Topology Change，TC）影响。频繁的拓扑变化会导致大量的网络重计算和转发数据库（Forwarding Database，FDB）刷新，影响网络性能和稳定性。</u>
# 例题backup和alternative
单选34/1247、MSTP有不同的端口角色，对此说法不正确的是
MSTP中除边缘端口外，其他端口角色都参与MSTP的计算过程
MSTP同端口在不同的生成树实例中可以担任不同的角色。
MSTP域边缘端口是指位于MST域的边缘并连接其它MST域SST的端口
**Backup端口作为根端口的备份，提供了从指定桥到根的另一条可切换路径**
<u>这个你应该必须对的，你已经知道backup和alternative的区别了，一个是在端口的 一个是在路径的备份
</u>

# 例题傻瓜交换机
![image-2024714514255.png|275](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/STP/image-2024714514255.png)
**SWA的两个端口都为指定端口，处于转发状态，**
SWC的G0/0/1 口为Alternate端口，处于阻塞状态
SWA的G0/0/2口为阻塞状态，
SWA为该简单网络中的根桥
<u>解析：因为HUB 的作用相当于傻瓜交换机，只用来集线，所以SWA 的G0/0/2 会被阻塞</u>
# 例题 边缘端口 bpdu保护

单选题84/1247、不同的场景下RSTP提供了不同的保护功能，关于此说法错误的是：
**交换设备上启动了BPDU保护功能后，如果边缘端口收到RST BPDU,边缘端口将被设置为 非边缘端口，并重新进行生成树计算**  △down口
启用防TC-BPDU报文攻击功能后，在单位时间内，交换设备处理TC BPDU报文的次数可配置
启用Root保护功能的指定端口，其端口角色只能保持为指定端口
启动根保护的指定端口，当该端口收到更优的RST BPDU后，端口会进入Discarding状态，不再转发报文。若一段时间内端口未收到更优的RST BPDU,则会自动恢复到正常的Forwarding状态

单选题
295/1247、在不同场景下，RSTP可提供不同的保护功能。以下关于STP保护功能的描述，错误的是哪一项？
**交换设备上启动了BPDU保护功能后，如果边缘端口收到RST BPDU，边缘端口将被设置为 非边缘端口，并重新进行生成树**
计算启用Root保护功能的指定端口，其端口角色只能保持为指定端口
启用防TC-BPDU报文攻击功能后，在单位时间内，交换设备处理TC BPDU报文的次数可配置
一旦使能Root保护功能的指定端口收到优先级更高的BPDU时，端口状态将进入Discarding状态，不再转发报文
<u>交换设备上启动了BPDU保护功能后，如果边缘端口收到RST BPDU，则该端口会Down掉。如果交换设备上只配置了边缘端口，未启用BPDU保护功能，则边缘端口收到RST BPDU时，会转换为普通STP端口，重新参与生成树计算</u>

<u>交换设备上启动了BPDU保护功能后，如果边缘端口收到RST BPDU，则该端口会Down掉。
如果交换设备上只配置了边缘端口，未启用BPDU保护功能，则边缘端口收到RST BPDU时，会转换为普通STP端口，重新参与生成树计算。
二次·解析：BPDU 保护是用于防止边缘端口意外或恶意地接收到 BPDU 报文，从而避免潜在的网络拓扑变化和环路。边缘设备就是那个不参与生成树运算的哪个。</u>
- **功能**：如果边缘端口接收到 BPDU 报文，BPDU 保护会立即将该端口关闭（errdisable），以防止其参与生成树计算，确保网络的稳定性和安全性。
- **配置**：可以在全局或端口级别启用 BPDU 保护。
# 例题 RSTP网络拓扑变动，改变机制是？
单选题100/1247、在RSTP协议中，当网络拓扑发生变化时，响应拓扑结构改变的机制是：
全网泛洪
修改MAC地址表的生存期
**对MAC地址表采取部分删除操作**
删除整个MAC地址表
<u>解析：一旦检测到拓扑发生变化，首先将进行如下处理：  
1-清空状态发生变化的端口上学习到的MAC地址。  
2-同时，由这些端口向外发送RST BPDU，其中TC置位。一旦TC While Timer超时，则停止发送RST BPDU。  
（STP网络发生拓扑变化时，是先通知到根桥，然后由根桥向全网发送TC报文。而RSTP网络发生拓扑变化时，变更点交换机直接向全网发送TC置位的BPDU报文）</u>
# 例题收敛过程描述
![image-20247182140727.png|350](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/STP/image-20247182140727.png)
SW2上游链路端口在收到SW1发来的BPDU 后.会立即进入Forwarding状态
**网络初始化时，图中所有交换机的端口都为指定端口，并处于Discarding状态**
SW3的边缘端口在一轮P/A机制之后，会立即进入Forwarding状态
下游链路的设备互联端口通过P/A机制 ，快速进入Forwarding状态
<u>默认情况下，每个交换机刚启动的时候，都认为自己是根交换机，所以每个端口都是指定端口，刚开始都是以处于 Discarding 状态，如此一来就不会出现临时性的环路SW3连接PC的端口设置为了边缘端口。但是边缘端口是不参与RSTP协议计算的，所以边缘端口不存在P/A机制(全称Proposing/Agreement机制，是 (RSTP) 和 l (MSTP) 的一种快速收敛机制。加速生成树协议的收敛时间，让指定端口能够更快地进入转发状态。)</u>


# 根桥和备份根桥
单选题296/1247、以下关于MSTP中根桥和备份根桥的描述，错误的是哪一项？
**设备可以通过计算来自动确定生成树的根桥或备份根桥**
用户可以手动配置设备为指定生成树的根桥或备份根桥
用户可以在每棵生成树中指定多个备份根桥
在一棵生成树中，生效的根桥只有一个
<u>MSTP不选举备份根桥，而是在每个MST Instance中只有一台根桥和若干备用端口。因此，选项中提到的“备份根桥”可能是针对RSTP或STP中的概念，而不是MSTP特有的。在MSTP中，用户可以配置根桥优先级，但不能指定“备份根桥”。</u>
# 保护功能
单选题297/1247、以下关于RSTP保护功能的描述，**错误**的是哪一项？
环路保护可以部署在根端口上，以防网络中形成环路
环路保护可以部署在Altermate端口上， 以防网络中形成环路
BPDU保护可以配置在边绿端口上，以防主机被恶意用户侵占，引I发网络震荡
**根保护可以部署在根端口上，用来确保根桥的角色不会因为一些网络问题而改变**
<u>在RSTP协议提供的安全机制中，根保护是配置在指定接口上的，环路保护功能只能在根端口或Alternate端口上配置生效。</u>

# 根桥配置

单选题 318/1247、如图所示，四台华为交换机已运行并配置了 MSTP协议，现需将SW3设置为Instance10的根桥，可通过以下哪些命
令实现？
![image-20247191052226.png|400](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/STP/image-20247191052226.png)
stp vlan10 root primary
stp instance 10 priority 4096
stp root primary
**stp instance 10 root primary**
# RSTP相比STP
单选题 414/1247、STP协议虽然能够解决环路问题，但是由于网络拓扑收敛慢，影响了用户通信质量，RSTP针对STP做了很多改进，以下哪一项**不是**RSTP对STP的改进？
运行RSTP的非根交换机按照Hello Time规定的时间间隔发送配置BPDU，该行为完全由每台设备自主进行
**如果一个端口连续4个Hello Time时间内没有收到上游设备发送过来的配置BPDU ，那么该设备认为与此邻居之间的协商失败**
RSTP删除了3种端口状态，新增加了2种端口角色
RSTP的端口状态规范是根据端口是否转发用户流量和学习MAC地址来划分的，把原来的5种端口状态缩减为3种如果在连续的3个hello之间内发现无法<u>收到对方设备发送过来的 BPDU，就认为邻居出现了问题</u>

# 初始的配置BPDU在STP计算的不包含转发延迟
单选题424/1247、在初始形成STP树的过程中，所有STP交换机会周期性地产生并发送配置BPDU。其中用于STP计算的参数不包括以下哪一项？
网桥ID
根路径开销
接口ID
**转发延迟**
开销，桥ID，端口ID都会参与计算，都属于配置BPDU上的参数

# 关于优先级向量
单选题460/1247、在MSTP中CIST和MSTI都是根据优先级向量来计算的，以下关于优先级向量的描述，错误的是哪一项？
根交换设备ID是用于选择CIST中根交换设备的
**内部路径开销是指本桥到达总根的路径开销**
域根ID是用于选择MSTI中域根的
根交换设备ID中的Priority是MSTI O的优先级
<u>内部路径开销是指本桥端口到主桥的开销。</u>

# mstp端口状态
单选题472/1247、以下关于MSTP端口状态的描述，错误的是哪一项？
根端口、指定端口和域边缘端口可处于Discarding状态
**Alternate 端口和Backup端口可处于 Learning 状态**
Alternate 端口和Backup端口只能处于Discarding状态
根端口、指定端口和域边缘端口最终会处于Forwarding状态
<u>Alternate端口和Backup端口只能处于Discarding状态</u>

# mstp收敛时间
![image-20247203739355.png|375](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-20247203739355.png)
**30秒**
2秒
4秒
15秒
<u>SW2和SW3相连端口收敛时间是2倍的Forward Delay（15s） ，即30秒</u>

# 端口角色
![image-20247205856430.png|425](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-20247205856430.png)
SW2的G0/0/1口是RP口， G0/0/2口是AP
SW4的G0/0/1口是AP口， G0/0/2□是RP
**SW4的G0/0/1口是RP口 ， G0/0/2口是AP**
SW2的G0/0/1 口是AP口， G0/0/2□是RP
![image-20247205842192.png|375](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-20247205842192.png)
# 端口判断
![image-2024720023209.png|425](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-2024720023209.png)
SWA 上的GE0/0/1为Backup端口
**SWB上的GE0/0/2为Altermate端口**
SWB将会成为根桥
SWB上的GE0/0/1为Altermate端口
<u>通过对比收到BPDU报文的PID判断，0/0/1口收到的报文更优，所以0/0/2为AP口</u>

# 端口判断
![image-2024720144257.png|375](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-2024720144257.png)
指定端口
根端口
Master端口
**域边缘端口**
<u>域边缘端口是指位于MST域的边缘并连接其它MST域或SST的端口。SW3连接SW5的端口就是域边缘端口。</u>
# 端口判断
![image-20247201437508.png|400](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-20247201437508.png)
SWB 上的GEO/0/2是Altemate 端口， SWC上的GEO/0/1 是Backup 端口
SWB 上的GE0/0/2是Root 端口， SWC 上的GE0/0/1是Designated端口
**SWB 上的GE0/0/2是Backup端口 ， SWC 上的GE0/0/1是Altemated端口**
SWB 上的GE0/0/2是Backup端口， SWC 上的GE0/0/1是Root端口
<u>在RSTP协议中，backup端口是指定端口端口的备份；altenate是根端口的备份。SWC的Gi0/0/1端口一定是自己的根端口的备份，所以一定是alternate端口。在SWB和SWC的互联链路上，存在三个端口。最好的端口就是SWB的指定端口，其次就是SWB的Gi0/0/2。所以SWB的Gi0/0/2应该是指定端口的备份，所以是backup端口。</u>

# 判断题
判断题 892/1247、 RSTP中定义了 4种端口角色，其中Alternative端口和Backup端口在STP报文中flags字段内的port role值一致都为01
**正确**
![image-20247222456723.png|170](8%E5%88%B7%E9%A2%98%E7%9A%84/HCIP-821/%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%98%B2%E7%8E%AF%E8%B7%AF%E5%8D%8F%E8%AE%AESTP/image-20247222456723.png)

判断题894/1247、RSTP中Backup端口可以替换发生故障的根端口
**错误**
<u>BP端口为DP端口做备份AP端口为RP端口做备份</u>

判断题 895/1247、 RSTP中处于Discarding状态下的端口，虽然会对接收到的数据帧做丢弃处理，但可以根据该端口收到的数据帧维护MAC地址表。
**错误**
<u>Discarding状态下的端口不接收数据帧，也不学习MAC地址。</u>

判断题 909/1247、 RSTP中边缘端口无需等待forWarding delay,可直接进入forWarding状态。如果边缘端口接收到了 BPDU,则边缘端口会被直接关闭并进入error down状态。
**错误**
<u>边缘端口不参与RSTP计算，可以由Discarding直接进入Forwarding状态。但是一旦边缘端口收到配置BPDU，就丧失了边缘端口属性，成为普通STP端口，并重新进行生成树计算，从而引起网络震荡。边缘端口的UP和Down，不会引起网络拓扑的变动。</u>

判断题925/1247、在MSTP协议中，每个MST Instance都单独使用RSTP算法，计算单独的生成树。
**正确**
<u>MSTP是多生成树，所以是多个RSTP生成树构成</u>

判断题953/1247、从组播源到接收者的最短路径，成为最短路径树SPT
**正确**
<u>最短路径树SPT（Short Path Tree）是网络的源点到所有结点的最短路径构成的树。</u>

判断题977/1247、不同于STP，RSTP的BPDU Type只有一种，其值为 2， RSTP中不存在TCN BPDU这种类型的BPDU
**正确**
<u>RSTP和MSTP都不需要TCN BPDU来拓扑变更</u>

判断题 999/1247、当一个运行MSTP协议的交换设备端口收到一个配置BPDU时，会与设备保存的全局配置消息进行对比。若新收到的配置BPDU更优，则会同步更新交换设备保存的全局配置消息：反之，则丢弃该配置BPDU。
**错误**
<u>不对比，而是直接替代。如果端口接收到的BPDU内包含的配置消息优于端口上保存的配置消息，则端口上原来保存的配置消息被新收到的配置消息替代。端口同时更新交换设备保存的全局配置消息。反之，新收到的BPDU被丢弃。</u>


判断题1006/1247、一个非边缘端口是否迁移到ForWarding状态是RSTP检测拓扑发生变化的标准之一。
**错误**
<u>只有一个标准。在RSTP中检测拓扑是否发生变化只有一个标准：一个非边缘端口迁移到Forwarding状态。</u>

判断题1039/1247、MSTP使用802.1D标准，向下兼容STP和RSTP，通过建立多棵无环路的树，解决广播风暴并实现余备份。
**错误**
<u>MSTP使用802.1S标准</u>

判断题 1049/1247、一个MST域内可以生成多棵生成树，每棵生成树都称为一个MSTI。其中MSTI使用Instance ID标识，华为设备取值为0-32768.
**错误**
<u>MSTI（Multiple Spanning Tree Instance，多生成树实例）：  一个MST域内可以生成多棵生成树，每棵生成树都称为一个MSTI。  MSTI使用Instance ID标识，华为设备取值为0~4094。</u>



1178/1247、在MSTP中 （） 端口是特殊域边缘端口，该端口在CIST上的角色是Root Port。（请填写全英文，首字母大写）
**Master**
<u>Master端口是特殊域边缘端口，Master端口在CIST上的角色是Root Port，在其它各实例上的角色都是Master端口</u>

填空题1189/1247、在RSTP中，可通过stp root primary命令，来配置当前设备为根桥。配置后该设备优先级自动为 （），并且不能更改设备优先级。
**0**